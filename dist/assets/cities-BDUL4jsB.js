import{r as t,t as X,q as Q,a6 as N,ab as V,j as e,aK as ge,aL as Ie,aM as be,a1 as P,ay as ye,aN as Fe,aO as Se,aP as we,B as q,aQ as Ce,f as ee,a9 as Le,aR as ve,aS as ke,aT as Ue,n as De,o as Ee,aU as Pe,aV as ae,a8 as re,aD as $e}from"./index-DpkaZWrN.js";import{u as J,w as Te}from"./xlsx-QGj7q-Kj.js";import{F as h}from"./index-wC8s570B.js";import{M as Y}from"./index-CWysUnmm.js";import{B as M}from"./button-Dt2JUpkg.js";import{S as k}from"./index-DBo6JS90.js";import{I as A}from"./index-Cygo-vfe.js";import{U as le}from"./index-CNdFJfq9.js";import{R as qe}from"./InboxOutlined-Cd-u5kYd.js";import{I as se}from"./index-BE-2iPGg.js";import{s as C}from"./index-Taqm7WFy.js";import{R as Ae}from"./UploadOutlined-CuuRIO2r.js";import{B as O}from"./Button-Cu5ozvId.js";import{T as _e}from"./TextField-BTqI7l2h.js";import{T as Me,a as Ne,e as Ve,c as ie,d as v,b as Be}from"./TableRow-eOUI4Xyy.js";import{C as Oe}from"./Checkbox-CSR8R-Xs.js";import{R as He}from"./DeleteOutlined-5nWwslxN.js";import"./BaseInput-B3LhqOGP.js";import"./useBreakpoint-CKKDg86l.js";import"./index-DmQU3z-_.js";import"./ExclamationCircleFilled-CpXgg2sl.js";import"./InfoCircleFilled-4f9TSxsu.js";import"./fade-BL1mnfhQ.js";import"./Input-mDCMwnQM.js";import"./getAllowClear-Bi388r9o.js";import"./TextArea-BcemaeHG.js";import"./DeleteOutlined-DFutYCzo.js";import"./DownloadOutlined-DTidZHln.js";import"./addEventListener-DCYVsBvi.js";import"./LeftOutlined-BqRQVFk4.js";import"./InputLabel-CJs9cArZ.js";const{Option:H}=k,{Dragger:Re}=le,Qe=t.forwardRef(({type:n,selectedCity:r,selectedArea:o},l)=>{const[U,m]=t.useState(!1),[d]=h.useForm(),[L,$]=t.useState(null),[D,b]=t.useState(null),x=X(),p=Q(s=>s.location.cities),y=Q(s=>s.location.areas),F=s=>{var c;const a=(c=s.fileList[0])==null?void 0:c.originFileObj;if(a){b(a);const u=new FileReader;u.onload=()=>$(u.result),u.readAsDataURL(a)}};t.useImperativeHandle(l,()=>({show:()=>{m(!0),n!=="city"&&x(N()),n==="locality"&&(r==null?void 0:r.name)==="Delhi"&&x(V({cityId:r.id}))}})),t.useEffect(()=>{r&&(n==="area"&&d.setFieldsValue({city:r.id}),n==="locality"&&(r.name==="Delhi"?d.setFieldsValue({city:r==null?void 0:r.id,area:o==null?void 0:o.id}):d.setFieldsValue({city:r.id})))},[r,n,d,o]);const S=()=>{m(!1),d.resetFields(),$(null),b(null)},E=async()=>{var s;try{const a=await d.validateFields();let c;if(n==="city"){if(!D){C.warning("Please upload an image");return}const u=new FormData;u.append("name",a.name),u.append("image",D),c=await x(ge(u))}else n==="area"?c=await x(Ie({city:r.id,name:a.name})):n==="locality"&&(c=await x(be({area_id:(o==null?void 0:o.id)||null,name:a.name,city_id:r.id})));((s=c==null?void 0:c.meta)==null?void 0:s.requestStatus)==="fulfilled"?(C.success(`${n} added successfully`),n==="city"?x(N()):n==="area"?x(V({cityId:r.id})):n==="locality"&&(r.name==="Delhi"?x(P({areaId:o==null?void 0:o.id})):x(P({cityId:r.id}))),S()):C.error(`Failed to add ${n}`)}catch(a){console.error("Add location error:",a)}},T=()=>{switch(n){case"city":return e.jsxs(e.Fragment,{children:[e.jsx(h.Item,{name:"name",label:"City Name",rules:[{required:!0,message:"Please enter city name"}],children:e.jsx(A,{placeholder:"Enter city name"})}),e.jsxs(h.Item,{name:"image",label:"Upload City Image",rules:[{required:!0,message:"Please upload an image"}],children:[e.jsxs(Re,{multiple:!1,maxCount:1,beforeUpload:()=>!1,onChange:F,accept:".png,.jpg,.jpeg,.webp",showUploadList:!1,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(qe,{style:{color:"#1677ff"}})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag QR file to this area to upload"}),e.jsx("p",{className:"ant-upload-hint",children:"Supports .png, .jpg, .jpeg, .webp files (max 1 file)"})]}),L&&e.jsx(se,{src:L,alt:"Preview",width:200,style:{marginTop:16,borderRadius:8,border:"1px solid #f0f0f0"},preview:!1})]})]});case"area":return e.jsxs(e.Fragment,{children:[e.jsx(h.Item,{name:"city",label:"Select City",rules:[{required:!0}],children:e.jsx(k,{placeholder:"Select city",children:p==null?void 0:p.map(s=>e.jsx(H,{value:s.id,children:s.name},s.id))})}),e.jsx(h.Item,{name:"name",label:"Area Name",rules:[{required:!0}],children:e.jsx(A,{placeholder:"Enter area name"})})]});case"locality":return(r==null?void 0:r.name)==="Delhi"?e.jsxs(e.Fragment,{children:[e.jsx(h.Item,{name:"city",label:"Select City",rules:[{required:!0}],children:e.jsx(k,{placeholder:"Select city",children:p==null?void 0:p.map(s=>e.jsx(H,{value:s.id,children:s.name},s.id))})}),e.jsx(h.Item,{name:"area",label:"Select Area",rules:[{required:!0}],children:e.jsx(k,{placeholder:"Select area",children:y==null?void 0:y.map(s=>e.jsx(H,{value:s.id,children:s.name},s.id))})}),e.jsx(h.Item,{name:"name",label:"Locality Name",rules:[{required:!0}],children:e.jsx(A,{placeholder:"Enter locality name"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(h.Item,{name:"city",label:"Select City",rules:[{required:!0}],children:e.jsx(k,{placeholder:"Select city",children:p==null?void 0:p.map(s=>e.jsx(H,{value:s.id,children:s.name},s.id))})}),e.jsx(h.Item,{name:"name",label:"Locality Name",rules:[{required:!0}],children:e.jsx(A,{placeholder:"Enter locality name"})})]});default:return null}};return e.jsx(Y,{title:`Add ${n}`,open:U,onCancel:S,centered:!0,footer:[e.jsx(M,{onClick:S,children:"Cancel"},"cancel"),e.jsx(M,{type:"primary",style:{backgroundColor:"#FA003F"},onClick:E,children:"Add"},"submit")],children:e.jsx(h,{form:d,layout:"vertical",children:T()})})}),{Option:ne}=k,We=t.forwardRef(({selected:n,type:r},o)=>{const l=X(),[U,m]=t.useState(!1),[d]=h.useForm(),[L,$]=t.useState(null),[D,b]=t.useState(null),{cities:x=[],areas:p=[],message:y,error:F,loading:S}=Q(a=>a.location);console.log(p,"areas");const E=a=>{var u;const c=(u=a.fileList[a.fileList.length-1])==null?void 0:u.originFileObj;if(c){b(c);const w=new FileReader;w.onload=()=>$(w.result),w.readAsDataURL(c)}};t.useImperativeHandle(o,()=>({show:()=>m(!0)})),t.useEffect(()=>{!n||!r||(r==="city"?d.setFieldsValue({name:n.name}):r==="area"?d.setFieldsValue({name:n.name,cityId:n.city_id}):r==="locality"&&d.setFieldsValue({name:n.name,cityId:n.city_id,areaId:n.area_id}))},[n,r,d]),t.useEffect(()=>{y&&(C.success(y),l(ye())),F&&C.error(F)},[y,F,l]);const T=()=>{m(!1),d.resetFields()},s=()=>{d.validateFields().then(a=>{let c,u;if(r==="city"){const w=new FormData;w.append("name",a.name),w.append("image",D),c={name:a.name},u=Fe({id:n.id,data:w})}else r==="area"?(c={name:a.name,cityId:a.cityId},u=Se({id:n.id,data:c})):r==="locality"&&(c={name:a.name,cityId:a.cityId,areaId:a.areaId},u=we({id:n.id,data:c}));l(u).unwrap().then(()=>{m(!1),d.resetFields(),l(N()),l(V({cityId:a.cityId})),l(P({cityId:a.areaId}))}).catch(()=>{})})};return console.log(r),e.jsx(Y,{title:`Update ${(r==null?void 0:r.charAt(0).toUpperCase())+(r==null?void 0:r.slice(1))}`,open:U,onCancel:T,centered:!0,width:500,footer:[e.jsx(M,{onClick:T,children:"Cancel"},"cancel"),e.jsx(M,{type:"primary",style:{backgroundColor:"#F75F0C"},loading:S,onClick:s,children:"Update"},"update")],children:e.jsxs(h,{form:d,layout:"vertical",children:[e.jsx(h.Item,{name:"name",rules:[{required:!0,message:`Please enter ${r} name`}],children:e.jsx(A,{placeholder:`Enter ${r} name`})}),r==="city"&&e.jsx(h.Item,{name:"image",label:"Upload Image",valuePropName:"fileList",getValueFromEvent:()=>null,children:e.jsxs(e.Fragment,{children:[e.jsx(le,{showUploadList:!1,beforeUpload:()=>!1,onChange:E,accept:"image/*",children:e.jsx(M,{icon:e.jsx(Ae,{}),children:"Upload"})}),L&&e.jsx(se,{src:L,alt:"Preview",width:100,height:50,style:{marginTop:10,borderRadius:8},preview:!1})]})}),(r==="area"||r==="locality")&&e.jsx(h.Item,{name:"cityId",label:"City",rules:[{required:!0,message:"Please select a city"}],children:e.jsx(k,{placeholder:"Select City",children:x.map(a=>e.jsx(ne,{value:a.id,children:a.name},a.id))})}),r==="locality"&&(n==null?void 0:n.area_id)&&e.jsx(h.Item,{name:"areaId",label:"Area",rules:[{required:!0,message:"Please select an area"}],children:e.jsx(k,{placeholder:"Select Area",children:p.map(a=>e.jsx(ne,{value:a.id,children:a.name},a.id))})})]})})}),R={backgroundColor:"#FA003F",color:"#fff","&:hover":{backgroundColor:"#FA003F"}},ze="https://api.houseapp.in/public";function Ca(){const n=t.useRef(),r=t.useRef(),o=X(),[l,U]=t.useState(null),[m,d]=t.useState(null),[L,$]=t.useState(""),[D,b]=t.useState(null),[x,p]=t.useState(null),[y,F]=t.useState(!1),[S,E]=t.useState(""),[T,s]=t.useState(!1),[a,c]=t.useState(null),{cities:u,areas:w,localities:oe,loading:te,error:Z}=Q(i=>i.location);if(t.useEffect(()=>{o(N())},[o]),te)return e.jsx(q,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:e.jsx(Ce,{})});if(Z)return e.jsx(q,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:e.jsx(ee,{color:"error",children:Z})});const de=i=>{(l==null?void 0:l.id)===i.id?(U(null),d(null)):(U(i),d(null),i.name==="Delhi"?o(V({cityId:i.id})):o(P({cityId:i.id})))},ce=i=>{(m==null?void 0:m.id)===i.id?d(null):(d(i),o(P({areaId:i.id})))},W=(i,j)=>{var g;p(i),b(j),(g=r.current)==null||g.show()},z=(i,j)=>{c({type:j,data:i}),E(""),F(!0)},me=async()=>{var i,j;if(!S){C.warning("Please enter your password");return}s(!0);try{const g=await o(Le(S));if(!((i=g.payload)!=null&&i.success)){C.error(((j=g.payload)==null?void 0:j.message)||"Incorrect password"),s(!1);return}(a==null?void 0:a.type)==="city"?(await o(ve(a.data.id)),(l==null?void 0:l.id)===a.data.id&&(U(null),d(null)),o(N())):(a==null?void 0:a.type)==="area"?(await o(ke(a.data.id)),(m==null?void 0:m.id)===a.data.id&&d(null),o(V({cityId:l.id}))):(await o(Ue(a.data.id)),o(m?P({areaId:m.id}):P({cityId:l.id}))),C.success(`${a==null?void 0:a.type} deleted successfully`),F(!1),E(""),c(null)}catch{C.error("Something went wrong!")}finally{s(!1)}},ue=()=>{var i;b("city"),(i=n.current)==null||i.show()},he=()=>{var i;b("area"),(i=n.current)==null||i.show()},fe=()=>{var i;b("locality"),(i=n.current)==null||i.show()},pe=(i,j)=>{const g=J.json_to_sheet(i.map(B=>({Name:B.name}))),I=J.book_new();J.book_append_sheet(I,g,j),Te(I,`${j}_Data.xlsx`)},xe=()=>(oe||[]).filter(i=>i.name.toLowerCase().includes(L.toLowerCase())),G=(i,j,g,I,B=!0,je=!1)=>e.jsx(De,{sx:{mb:3,boxShadow:4,borderRadius:3},children:e.jsxs(Ee,{children:[e.jsxs(q,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(ee,{variant:"h6",color:"primary",children:i}),e.jsx(q,{sx:{display:"flex",gap:1},children:e.jsx(O,{sx:R,onClick:()=>pe(j,i),children:"Export"})})]}),je&&e.jsx(_e,{fullWidth:!0,size:"small",placeholder:"Search Locality...",variant:"outlined",value:L,onChange:f=>$(f.target.value),sx:{mb:2}}),e.jsx(Me,{component:Pe,elevation:0,sx:{borderRadius:2},children:e.jsxs(Ne,{children:[e.jsx(Ve,{sx:{backgroundColor:"#f0f4f8"},children:e.jsxs(ie,{children:[B&&e.jsx(v,{children:"Select"}),e.jsxs(v,{children:[i," Name"]}),i==="City"&&e.jsx(v,{children:"Image"}),e.jsx(v,{children:"Action"})]})}),e.jsx(Be,{children:j.map(f=>e.jsxs(ie,{hover:!0,selected:(I==null?void 0:I.id)===f.id,onClick:()=>g==null?void 0:g(f),sx:{backgroundColor:(I==null?void 0:I.id)===f.id?"#ffe0b2":"inherit","&:hover":{backgroundColor:"#fff3e0",cursor:"pointer"}},children:[B&&e.jsx(v,{children:e.jsx(Oe,{checked:(I==null?void 0:I.id)===f.id})}),e.jsx(v,{children:e.jsx("b",{children:f.name})}),i==="City"&&e.jsx(v,{children:e.jsx("img",{src:`${ze}${f.image}`,alt:"image",height:50})}),e.jsxs(v,{children:[e.jsx(ae,{title:"Edit",children:e.jsx(re,{onClick:K=>{K.stopPropagation();const _=i.toLowerCase();_.includes("city")?W(f,"city"):_.includes("area")?W(f,"area"):W(f,"locality")},sx:{backgroundColor:"orange",color:"white","&:hover":{backgroundColor:"#e65100"}},children:e.jsx($e,{})})}),e.jsx(ae,{title:"Delete",children:e.jsx(re,{onClick:K=>{K.stopPropagation();const _=i.toLowerCase();_.includes("city")?z(f,"city"):_.includes("area")?z(f,"area"):z(f,"locality")},sx:{backgroundColor:"red",color:"white",ml:1,"&:hover":{backgroundColor:"#b71c1c"}},children:e.jsx(He,{})})})]})]},f.id))})]})})]})});return e.jsxs(q,{sx:{p:4,backgroundColor:"#f9f9f9",minHeight:"100vh"},children:[e.jsxs(q,{sx:{mb:3,display:"flex",gap:2},children:[e.jsx(O,{sx:R,onClick:ue,children:"Add City"}),(l==null?void 0:l.name)==="Delhi"&&e.jsx(O,{sx:R,onClick:he,children:"Add Area"}),l&&e.jsx(O,{sx:R,onClick:fe,children:"Add Locality"})]}),G("City",u||[],de,l),(l==null?void 0:l.name)==="Delhi"&&G(`Areas in ${l.name}`,w||[],ce,m),l&&G(`Localities in ${(m==null?void 0:m.name)||(l==null?void 0:l.name)}`,xe(),null,null,!1,!0),e.jsx(Qe,{ref:n,selectedCity:l,selectedArea:m,type:D}),e.jsx(We,{ref:r,selected:x,type:D}),e.jsxs(Y,{title:"Confirm Password",open:y,onOk:me,confirmLoading:T,onCancel:()=>F(!1),okText:"Delete",cancelText:"Cancel",children:[e.jsx("p",{children:"Please enter your password to confirm deletion:"}),e.jsx(A.Password,{value:S,onChange:i=>E(i.target.value),placeholder:"Enter password"})]})]})}export{Ca as default};
