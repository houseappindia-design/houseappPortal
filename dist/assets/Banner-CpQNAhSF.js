import{r,t as q,q as P,a1 as E,j as e,bA as N,bB as A,az as $,a4 as z,bC as V}from"./index-DwiSOD9c.js";import{h as B}from"./moment-G82_0lEo.js";import{F as i}from"./index-BXC7R0mQ.js";import{M as L}from"./index-B4A0SNLa.js";import{I as k}from"./index-DJWdBMRR.js";import{D as F}from"./index-DSyBAw3q.js";import{S as w}from"./index-B7sXoiaU.js";import{U as O}from"./index-BCBtW8g7.js";import{R as H}from"./InboxOutlined-BjDtlEVU.js";import{I as Y}from"./index-BUTBrI8_.js";import{B as D}from"./button-Cq75W-mV.js";import{s as y}from"./index-BGEbJUl8.js";import{R as G}from"./CloseCircleOutlined-6c1uVN2R.js";import{R as K}from"./PlusOutlined-Cv4J3Q0y.js";import{F as J}from"./Table-CNVF8MzG.js";import{T as Q}from"./index-D9U7revJ.js";import{S as W}from"./Pagination-BFimxIqL.js";import{T as M}from"./BaseInput-BZp1MtTH.js";import{R as X}from"./DeleteOutlined-xgU-Q1y1.js";import"./useBreakpoint-BXR_P4Ln.js";import"./index-CiTCjMRU.js";import"./ExclamationCircleFilled-DbgLqVCX.js";import"./InfoCircleFilled-D4k5AYKS.js";import"./fade-DoVLCcQW.js";import"./Input-8-1QFgZP.js";import"./getAllowClear-Bnmqd7dR.js";import"./TextArea-ChHVglv9.js";import"./DeleteOutlined-DFutYCzo.js";import"./DownloadOutlined-DTidZHln.js";import"./addEventListener-22f-zY38.js";import"./LeftOutlined-FLk1rsHW.js";import"./PlusOutlined-ByZyTB3m.js";import"./styleChecker-DTayKWbn.js";import"./EllipsisOutlined-nWYUXzi1.js";import"./index-Z87dX1v5.js";const{Option:U}=w,{Dragger:Z}=O,ee=r.forwardRef((n,S)=>{const[x,h]=r.useState(!1),o=r.useRef(null),[f]=i.useForm(),[d,g]=r.useState(null),[m,j]=r.useState(null),[c,_]=r.useState(null),u=q(),{cities:I,loading:T}=P(s=>s.location);r.useImperativeHandle(S,()=>({open:()=>h(!0)})),r.useEffect(()=>{x&&o.current&&o.current.scrollTo({top:0,behavior:"smooth"})},[x]),r.useEffect(()=>{u(E())},[u]);const R=s=>{var l;const t=(l=s.fileList[s.fileList.length-1])==null?void 0:l.originFileObj;if(t){j(t);const b=new FileReader;b.onload=()=>g(b.result),b.readAsDataURL(t)}},a=s=>{_(s),f.setFieldsValue({end_time:null})},p=async s=>{if(!m)return y.error("Please upload an image");const t=new FormData;t.append("title",s.title),t.append("link_url",s.link_url),t.append("start_time",s.start_time),t.append("end_time",s.end_time),t.append("image",m),t.append("city_id",parseInt(s.city_id)),t.append("position",s.position);try{await u(N(t)),y.success("Banner added successfully"),h(!1),f.resetFields(),j(null),g(null),u(A())}catch{y.error("Failed to add banner")}};return e.jsx(L,{title:"Add Banner",open:x,onCancel:()=>h(!1),footer:null,children:e.jsx("div",{ref:o,style:{maxHeight:"70vh",overflowY:"auto",paddingRight:10},children:e.jsxs(i,{form:f,layout:"vertical",onFinish:p,children:[e.jsx(i.Item,{label:"Title",name:"title",rules:[{required:!0}],children:e.jsx(k,{})}),e.jsx(i.Item,{label:"Link URL",name:"link_url",rules:[{required:!0}],children:e.jsx(k,{})}),e.jsx(i.Item,{label:"Start Time",name:"start_time",rules:[{required:!0}],children:e.jsx(F,{showTime:!0,format:"YYYY-MM-DD hh:mm A",use12Hours:!0,style:{width:"100%"},onChange:a,disabledDate:s=>s&&s<B().startOf("day")})}),e.jsx(i.Item,{label:"End Time",name:"end_time",rules:[{required:!0}],children:e.jsx(F,{showTime:!0,format:"YYYY-MM-DD hh:mm A",use12Hours:!0,style:{width:"100%"},disabled:!c,disabledDate:s=>s&&c&&s<c.startOf("day")})}),e.jsx(i.Item,{name:"position",label:"Banner Type",rules:[{required:!0,message:"Please select banner type"}],children:e.jsxs(w,{children:[e.jsx(U,{value:"Home Page Banner",children:"Home Page Banner"}),e.jsx(U,{value:"Top Banner",children:"Top Banner"})]})}),e.jsx(i.Item,{name:"city_id",label:"Select Locality",rules:[{required:!0,message:"Please select a locality"}],children:e.jsx(w,{placeholder:"Select a locality",loading:T,children:I==null?void 0:I.map(s=>e.jsx(U,{value:s.id,children:s.name},s.id))})}),e.jsxs(i.Item,{label:"Upload Image",name:"image",rules:[{required:!0,message:"Please upload an image"}],children:[e.jsxs(Z,{name:"file",multiple:!1,showUploadList:!1,beforeUpload:()=>!1,onChange:R,accept:".png,.jpg,.jpeg,.webp",style:{borderRadius:8},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(H,{style:{color:"#1677ff"}})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag image to this area to upload"}),e.jsx("p",{className:"ant-upload-hint",children:"Supports .png, .jpg, .jpeg, .webp files (max 1 file)"})]}),d&&e.jsx(Y,{src:d,alt:"Preview",width:120,style:{marginTop:10,borderRadius:8},preview:!1})]}),e.jsx(i.Item,{children:e.jsx(D,{type:"primary",htmlType:"submit",block:!0,className:"custom-orange-button",children:"Submit"})})]})})})}),te="https://api.houseapp.in/public",{Option:v}=w,{Dragger:se}=O,re=r.forwardRef(({data:n},S)=>{const[x,h]=r.useState(!1),[o]=i.useForm(),[f,d]=r.useState(null),[g,m]=r.useState(null),[j,c]=r.useState(null),_=r.useRef(null),u=q(),{cities:I,loading:T}=P(t=>t.location);r.useImperativeHandle(S,()=>({open:()=>{n?(o.resetFields(),o.setFieldsValue({title:n.title,link_url:n.link_url,position:n.position,start_time:B(n.start_time),end_time:B(n.end_time),city_id:n.city_id}),c(B(n.start_time)),d(`${te}/${n.image_url}`),m(null)):(o.resetFields(),d(null),m(null),c(null)),h(!0)}}),[n,o]);const R=t=>{var b;const l=(b=t.fileList[t.fileList.length-1])==null?void 0:b.originFileObj;if(l){m(l);const C=new FileReader;C.onload=()=>d(C.result),C.readAsDataURL(l)}},a=t=>{c(t),o.setFieldsValue({end_time:null})},p=async t=>{try{const l=new FormData;l.append("title",t.title),l.append("link_url",t.link_url),l.append("start_time",t.start_time.toISOString()),l.append("end_time",t.end_time.toISOString()),l.append("city_id",t.city_id),l.append("position",t.position),g&&l.append("image",g),await new Promise(b=>setTimeout(b,1e3)),y.success("Banner updated successfully"),h(!1),o.resetFields(),m(null),d(null),c(null)}catch{y.error("Failed to update banner")}},s=()=>{h(!1),o.resetFields(),m(null),d(null),c(null)};return r.useEffect(()=>{u(E())},[u]),e.jsx(L,{title:"Update Banner",open:x,onCancel:s,footer:null,destroyOnClose:!0,width:600,children:e.jsx("div",{ref:_,style:{maxHeight:"70vh",overflowY:"auto",paddingRight:10},children:e.jsxs(i,{form:o,layout:"vertical",onFinish:p,children:[e.jsx(i.Item,{label:"Title",name:"title",rules:[{required:!0,message:"Title is required"}],children:e.jsx(k,{})}),e.jsx(i.Item,{label:"Link URL",name:"link_url",rules:[{required:!0,message:"Link URL is required"}],children:e.jsx(k,{})}),e.jsx(i.Item,{label:"Start Time",name:"start_time",rules:[{required:!0,message:"Start time is required"}],children:e.jsx(F,{showTime:!0,format:"YYYY-MM-DD hh:mm A",use12Hours:!0,style:{width:"100%"},onChange:a,disabledDate:t=>t&&t<B().startOf("day")})}),e.jsx(i.Item,{label:"End Time",name:"end_time",rules:[{required:!0,message:"End time is required"}],children:e.jsx(F,{showTime:!0,format:"YYYY-MM-DD hh:mm A",use12Hours:!0,style:{width:"100%"},disabled:!j,disabledDate:t=>t&&j&&t<j})}),e.jsx(i.Item,{name:"position",label:"Banner Type",rules:[{required:!0,message:"Please select banner type"}],children:e.jsxs(w,{children:[e.jsx(v,{value:"Home Page Banner",children:"Home Page Banner"}),e.jsx(v,{value:"Top Banner",children:"Top Banner"})]})}),e.jsx(i.Item,{name:"city_id",label:"Select Locality",rules:[{required:!0,message:"Please select a locality"}],children:e.jsx(w,{placeholder:"Select a locality",loading:T,children:I.map(t=>e.jsx(v,{value:t.id,children:t.name},t.id))})}),e.jsx(i.Item,{label:"Upload Image",name:"image",rules:[{required:!f,message:"Image is required"}],children:f?e.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[e.jsx(Y,{src:f,alt:"Preview",width:120,style:{borderRadius:8},preview:!1}),e.jsx(G,{onClick:()=>{d(null),m(null)},style:{position:"absolute",top:-10,right:-10,fontSize:20,color:"red",cursor:"pointer",background:"white",borderRadius:"50%"},title:"Remove Image"})]}):e.jsxs(se,{name:"file",multiple:!1,showUploadList:!1,beforeUpload:()=>!1,onChange:R,accept:".png,.jpg,.jpeg,.webp",style:{borderRadius:8},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(H,{style:{color:"#1677ff"}})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag image to this area to upload"}),e.jsx("p",{className:"ant-upload-hint",children:"Supports .png, .jpg, .jpeg, .webp files (max 1 file)"})]})}),e.jsx(i.Item,{children:e.jsx(D,{type:"primary",htmlType:"submit",block:!0,className:"custom-orange-button",children:"Update Now"})})]})})})}),ae="https://api.houseapp.in/public",Ee=()=>{const n=q(),{banners:S,loading:x}=P(a=>a.banner),[h,o]=r.useState(null),[f,d]=r.useState(!1),[g,m]=r.useState(""),[j,c]=r.useState(null),_=r.useRef(),u=r.useRef();r.useEffect(()=>{n(A())},[n]);const I=a=>{c(a),m(""),d(!0)},T=()=>{if(!g){y.warning("Please enter your password");return}n(z(g)).then(a=>{var p,s;if(!((p=a.payload)!=null&&p.success)){y.error(((s=a.payload)==null?void 0:s.message)||"Incorrect password");return}n(V(j)).then(()=>{y.success("Banner deleted successfully"),d(!1),m(""),c(null),n(A())})})},R=[{title:"Title",dataIndex:"title",render:(a,p)=>e.jsx("a",{href:p.link_url,target:"_blank",rel:"noreferrer",children:a})},{title:"Image",dataIndex:"image_url",render:(a,p)=>e.jsx("a",{href:p.link_url,target:"_blank",rel:"noreferrer",children:e.jsx(Y,{width:100,src:`${ae}${a}`})})},{title:"City Name",dataIndex:"city_name"},{title:"Start Time",dataIndex:"start_time"},{title:"End Time",dataIndex:"end_time"},{title:"Active",dataIndex:"is_active",render:a=>e.jsx(Q,{color:a?"green":"red",children:a?"Active":"Inactive"})},{title:"Position",dataIndex:"position"},{title:"Actions",render:a=>e.jsxs(W,{children:[e.jsx(M,{title:"Edit",children:e.jsx(D,{icon:e.jsx($,{}),className:"custom-orange-button",onClick:()=>{o(a),u.current.open(a)}})}),e.jsx(M,{title:"Delete",children:e.jsx(D,{danger:!0,icon:e.jsx(X,{}),onClick:()=>I(a.banner_id)})})]})}];return e.jsxs("div",{style:{padding:24},children:[e.jsx("div",{style:{textAlign:"right",marginBottom:16},children:e.jsx(D,{className:"custom-orange-button",type:"primary",icon:e.jsx(K,{}),onClick:()=>_.current.open(),children:"Add Banner"})}),e.jsx(J,{columns:R,dataSource:S,rowKey:"id",pagination:{pageSize:10},bordered:!0,loading:x}),e.jsx(ee,{ref:_}),e.jsx(re,{ref:u,data:h}),e.jsxs(L,{title:"Confirm Password",open:f,onOk:T,confirmLoading:x,onCancel:()=>d(!1),okText:"Delete",cancelText:"Cancel",children:[e.jsx("p",{children:"Please enter your password to confirm deletion:"}),e.jsx(k.Password,{value:g,onChange:a=>m(a.target.value),placeholder:"Enter password"})]})]})};export{Ee as default};
