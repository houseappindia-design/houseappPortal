import{r as s,aq as z,t as k,q as N,au as ae,j as e,av as oe,aw as $,X as re,ax as q,ay as le,az as ne}from"./index-ar-wW8Y1.js";import{r as ie,u as E,w as ce}from"./xlsx-QGj7q-Kj.js";import{h as de}from"./moment-G82_0lEo.js";import{F as m}from"./index-BpwQk-vJ.js";import{s as S}from"./index-2HXk8GLO.js";import{M as R}from"./index-5bofNX0R.js";import{I}from"./index-BK3JDoMW.js";import{D as B,d as me}from"./index-1k77Bzr6.js";import{S as F}from"./index-BMpPtwSl.js";import{B as f}from"./button-BCWlUTrE.js";import{S as O}from"./Pagination-SU3SLqJQ.js";import{R as ue}from"./SearchOutlined-iwZ2K_km.js";import{R as pe}from"./ReloadOutlined-M1yBUwcd.js";import{R as he}from"./PlusOutlined-6Rli_ctn.js";import{U as fe}from"./index-DJOI9_GO.js";import{R as xe}from"./DownloadOutlined-C-kKSBkn.js";import{F as je}from"./Table-IuPX_Wg5.js";import{T as L}from"./BaseInput-Dex--e16.js";import{R as ye}from"./DeleteOutlined-Y4uqRGT-.js";import"./useBreakpoint-BQ0ZzjB-.js";import"./index-DH8r-IvP.js";import"./ExclamationCircleFilled-WqnR6F3o.js";import"./InfoCircleFilled-DyHeZbDL.js";import"./fade-CHbOdMiJ.js";import"./Input-DYVU8m7g.js";import"./getAllowClear-BsFi4imL.js";import"./TextArea-3kCh4zOq.js";import"./LeftOutlined-TRALdpwB.js";import"./PlusOutlined-ByZyTB3m.js";import"./DeleteOutlined-DFutYCzo.js";import"./DownloadOutlined-DTidZHln.js";import"./styleChecker-U0VtqI39.js";import"./addEventListener-be7uzAZi.js";import"./EllipsisOutlined-CsLI2rJ7.js";import"./index-Cm6oqKQF.js";var ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"};function D(){return D=Object.assign?Object.assign.bind():function(r){for(var l=1;l<arguments.length;l++){var a=arguments[l];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(r[n]=a[n])}return r},D.apply(this,arguments)}const be=(r,l)=>s.createElement(z,D({},r,{ref:l,icon:ge})),we=s.forwardRef(be);var Ce={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"};function M(){return M=Object.assign?Object.assign.bind():function(r){for(var l=1;l<arguments.length;l++){var a=arguments[l];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(r[n]=a[n])}return r},M.apply(this,arguments)}const ve=(r,l)=>s.createElement(z,M({},r,{ref:l,icon:Ce})),Ie=s.forwardRef(ve),{Option:T}=F,Se=s.forwardRef(({tableData:r,setTableData:l,selectedEmployee:a},n)=>{const c=k(),[p,j]=s.useState(!1),[h]=m.useForm(),{message:x,error:y,loading:o}=N(b=>b.employee);s.useImperativeHandle(n,()=>({show:()=>j(!0)})),s.useEffect(()=>{a&&h.setFieldsValue({name:a.name,email:a.email,dob:a.dob?de(a.dob,"YYYY-MM-DD"):null,status:a.status||"Active"})},[a,h]),s.useEffect(()=>{x&&(S.success(x),c(ae())),y&&S.error(y)},[x,y,c]);const d=()=>{j(!1),h.resetFields()},g=()=>{h.validateFields().then(b=>{const u={name:b.name,email:b.email,dob:b.dob.format("YYYY-MM-DD"),status:b.status};c(oe({id:a.id,userData:u})).unwrap().then(()=>{const A=r.map(w=>w.id===a.id?{...w,...u}:w);l(A),j(!1),h.resetFields()}).catch(()=>{})})};return e.jsx(R,{title:"Update Employee",open:p,onCancel:d,centered:!0,width:500,footer:[e.jsx(f,{onClick:d,children:"Cancel"},"cancel"),e.jsx(f,{type:"primary",style:{backgroundColor:"#F75F0C"},loading:o,onClick:g,children:"Update"},"update")],children:e.jsxs(m,{form:h,layout:"vertical",children:[e.jsx(m.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter a name"}],children:e.jsx(I,{placeholder:"Name"})}),e.jsx(m.Item,{name:"email",label:"Email",rules:[{required:!0,type:"email",message:"Please enter a valid email"}],children:e.jsx(I,{placeholder:"Email"})}),e.jsx(m.Item,{name:"dob",label:"Date of Birth",rules:[{required:!0,message:"Please select date of birth"}],children:e.jsx(B,{style:{width:"100%"}})}),e.jsx(m.Item,{name:"status",label:"Status",rules:[{required:!0,message:"Please select a status"}],children:e.jsxs(F,{placeholder:"Select status",children:[e.jsx(T,{value:"Active",children:"Active"}),e.jsx(T,{value:"Inactive",children:"Inactive"})]})})]})})}),Fe=s.forwardRef(({tableData:r,setTableData:l},a)=>{const[n,c]=s.useState(!1),[p]=m.useForm(),j=k();s.useImperativeHandle(a,()=>({show:()=>c(!0)}));const h=()=>{c(!1),p.resetFields()},x=async()=>{var y;try{const o=await p.validateFields(),d={name:o.name,email:o.email,password:o.password,dob:me(o.dob).format("YYYY-MM-DD"),managerId:1},g=await j($(d));if($.fulfilled.match(g)){S.success("Employee added successfully!");const b=(y=g.payload)==null?void 0:y.user,u=r.length+1;l([...r,{...d,id:u,key:u}]),c(!1),p.resetFields()}else S.error("Failed to add employee.")}catch(o){console.error("Add employee error:",o)}};return e.jsx(R,{title:"Add Employee",open:n,onCancel:h,centered:!0,footer:[e.jsx(f,{onClick:h,children:"Cancel"}),e.jsx(f,{type:"primary",style:{backgroundColor:"#F75F0C"},onClick:x,children:"Add"})],children:e.jsxs(m,{form:p,layout:"vertical",children:[e.jsx(m.Item,{name:"name",label:"Name",rules:[{required:!0}],children:e.jsx(I,{placeholder:"Name"})}),e.jsx(m.Item,{name:"email",label:"Email",rules:[{required:!0,type:"email"}],children:e.jsx(I,{placeholder:"Email"})}),e.jsx(m.Item,{name:"password",label:"Password",rules:[{required:!0,type:"Password"}],children:e.jsx(I,{placeholder:"Password"})}),e.jsx(m.Item,{name:"dob",label:"Date of Birth",rules:[{required:!0}],children:e.jsx(B,{style:{width:"100%"}})})]})})}),{Option:Ee}=F,ke=s.forwardRef(({selectedEmployee:r},l)=>{const[a,n]=s.useState(!1),[c]=m.useForm(),p=k(),{localities:j,loading:h}=N(o=>o.location);console.log(r,"selectedEmployee"),s.useImperativeHandle(l,()=>({show:()=>n(!0)})),s.useEffect(()=>{p(re())},[p]);const x=()=>{n(!1),c.resetFields()};s.useEffect(()=>{a&&r&&c.setFieldsValue({name:r.name})},[a,r,c]);const y=async()=>{try{const d={locality_id:(await c.validateFields()).locality,manager_id:r.id};console.log(d,"payload");const g=await p(q(d));q.fulfilled.match(g)?(S.success("Assin localties successfully!"),c.resetFields(),n(!1)):S.error("Failed to add limit.")}catch(o){console.error("Error adding limit:",o)}};return e.jsx(R,{title:"Add Locality Limit",open:a,onCancel:x,centered:!0,footer:[e.jsx(f,{onClick:x,children:"Cancel"}),e.jsx(f,{type:"primary",style:{backgroundColor:"#FA003F",borderColor:"#FA003F"},onClick:y,children:"Add"})],children:e.jsxs(m,{form:c,layout:"vertical",children:[e.jsx(m.Item,{name:"locality",label:"Select Localities",rules:[{required:!0,message:"Please select at least one locality"}],children:e.jsx(F,{mode:"multiple",placeholder:"Select localities",loading:h,allowClear:!0,filterOption:(o,d)=>d.children.toLowerCase().includes(o.toLowerCase()),children:j==null?void 0:j.map(o=>e.jsx(Ee,{value:o.id,children:o.name},o.id))})}),e.jsx(m.Item,{name:"name",label:"name",rules:[{required:!0,message:"Please enter a limit"}],children:e.jsx(I,{min:0,style:{width:"100%"}})})]})})}),{Option:Re}=F,{confirm:Ae}=R,ut=()=>{const r=s.useRef(),l=s.useRef(),a=s.useRef(),n=k(),{list:c,loading:p,message:j,error:h}=N(t=>t.employee),{data:x=[],total:y=0}=c,[o,d]=s.useState([]),[g,b]=s.useState(""),[u,A]=s.useState(10),[w,_]=s.useState(1),[P,Y]=s.useState(null);s.useEffect(()=>{n(le({page:w,pageSize:u}))},[n,w,u]),s.useEffect(()=>{d(x.map(t=>({key:t.id,...t,dob:new Date(t.dob).toLocaleDateString()})))},[x]);const U=t=>{console.log("Opening confirm for:",t),Ae({title:"Are you sure you want to delete this employee?",icon:e.jsx(we,{}),content:`Name: ${t.name}`,okText:"Yes",okType:"danger",cancelText:"No",onOk(){d(i=>i.filter(v=>v.key!==t.key)),S.success("Employee deleted successfully")}})},V=t=>{Y(t),l.current.show()},H=()=>{r.current.show()},K=()=>{const t=E.json_to_sheet(o),i=E.book_new();E.book_append_sheet(i,t,"Employees"),ce(i,"employees.xlsx")},X=t=>{const i=new FileReader;return i.onload=v=>{const C=ie(v.target.result,{type:"binary"}),Z=C.Sheets[C.SheetNames[0]],ee=E.sheet_to_json(Z);d(ee.map((te,se)=>({key:se+1,...te})))},i.readAsBinaryString(t),!1},G=t=>{Y(t),a.current.show()},J=o.filter(t=>t.name.toLowerCase().includes(g)||t.email.toLowerCase().includes(g)),Q=[{title:"Sr.No",render:(t,i,v)=>(w-1)*u+v+1,width:60},{title:"Name",dataIndex:"name",sorter:(t,i)=>t.name.localeCompare(i.name)},{title:"DOB",dataIndex:"dob"},{title:"Email",dataIndex:"email"},{title:"Actions",render:(t,i)=>e.jsxs(O,{children:[e.jsx(L,{title:"Edit",children:e.jsx(f,{icon:e.jsx(ne,{}),className:"custom-orange-button",onClick:()=>V(i)})}),e.jsx(L,{title:"Delete",children:e.jsx(f,{danger:!0,icon:e.jsx(ye,{}),className:"custom-orange-button-delete",onClick:()=>U(i)})}),e.jsx(L,{title:"Assign",children:e.jsx(f,{danger:!0,icon:e.jsx(Ie,{}),className:"custom-orange-button-delete",onClick:()=>G(i)})})]})}],W=()=>{const i=(w-1)*u+1,v=Math.min(w*u,0);return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{children:["Showing ",i," to ",v," of ",0," entries"]}),e.jsxs("div",{children:["Show  ",e.jsx(F,{value:u,onChange:C=>{A(C),_(1)},size:"small",style:{width:100},children:[5,10,20,50,100].map(C=>e.jsx(Re,{value:C,children:C},C))}),"  entries"]})]})};return e.jsxs("div",{className:"employee-container",children:[e.jsxs("div",{className:"employee-header",children:[e.jsxs(O,{children:[e.jsx(I,{placeholder:"Search...",prefix:e.jsx(ue,{}),value:g,onChange:t=>b(t.target.value.toLowerCase()),allowClear:!0,className:"employee-search-input"}),e.jsx(f,{icon:e.jsx(pe,{}),onClick:()=>b("")})]}),e.jsxs(O,{children:[e.jsx(f,{className:"custom-orange-button",icon:e.jsx(he,{}),onClick:H,children:"Add Employee"}),e.jsx(fe,{showUploadList:!1,beforeUpload:X,accept:".xlsx"}),e.jsx(f,{className:"custom-orange-button",icon:e.jsx(xe,{}),onClick:K,children:"Export"})]})]}),e.jsx(je,{columns:Q,dataSource:J,rowKey:"key",loading:p,pagination:{current:w,pageSize:u,total:y,onChange:_,showSizeChanger:!1},footer:W,bordered:!0,rowClassName:(t,i)=>i%2===0?"table-row-light":"table-row-dark"}),e.jsx(Se,{ref:l,tableData:o,setTableData:d,selectedEmployee:P}),e.jsx(Fe,{ref:r,tableData:o,setTableData:d}),e.jsx(ke,{ref:a,selectedEmployee:P})]})};export{ut as default};
