import{r as s,t as q,q as P,a1 as M,j as e,bA as N,bB as A,az as $,a4 as z,bC as V}from"./index-CfVxbtSE.js";import{h as B}from"./moment-G82_0lEo.js";import{F as i}from"./index-IK64T2rr.js";import{M as L}from"./index-D0fUZM7x.js";import{I as k}from"./index-De5IC8Mb.js";import{D as C}from"./index-CDvgyEyM.js";import{S as w}from"./index-Ca2fJ2Be.js";import{U as O}from"./index-B0ano93T.js";import{R as H}from"./InboxOutlined-DsN71O0a.js";import{I as Y}from"./index-BnCVntcw.js";import{B as D}from"./button-C5_Hdfhk.js";import{s as y}from"./index-CAWaTUU6.js";import{R as G}from"./CloseCircleOutlined-B8f-ZdqI.js";import{R as K}from"./PlusOutlined-DSYM_dqM.js";import{F as J}from"./Table-CrVbExSL.js";import{T as Q}from"./index-0q7DeYG-.js";import{S as W}from"./Pagination-DQ3OUtW1.js";import{T as E}from"./BaseInput-UAXxaOaj.js";import{R as X}from"./DeleteOutlined-CEjlGUC9.js";import"./useBreakpoint-DahyjXEM.js";import"./index-rEwSGeGD.js";import"./ExclamationCircleFilled-C_flDW-8.js";import"./InfoCircleFilled-B5DrW48x.js";import"./fade-DAKRryvs.js";import"./Input-CpVgZGc3.js";import"./getAllowClear-Uyr8yb_4.js";import"./EyeOutlined-CQIrlTwV.js";import"./TextArea-D1eH27Bs.js";import"./DeleteOutlined-DFutYCzo.js";import"./DownloadOutlined-DTidZHln.js";import"./addEventListener-CtglvHnr.js";import"./LeftOutlined-Ox-gq8LW.js";import"./PlusOutlined-ByZyTB3m.js";import"./styleChecker-jUO8vhoa.js";import"./EllipsisOutlined-BDdOVdji.js";import"./index-0bLpuKAD.js";const{Option:U}=w,{Dragger:Z}=O,ee=s.forwardRef((n,S)=>{const[c,f]=s.useState(!1),m=s.useRef(null),[g]=i.useForm(),[o,x]=s.useState(null),[d,j]=s.useState(null),[p,_]=s.useState(null),u=q(),{cities:I,loading:T}=P(r=>r.location);s.useImperativeHandle(S,()=>({open:()=>f(!0)})),s.useEffect(()=>{c&&m.current&&m.current.scrollTo({top:0,behavior:"smooth"})},[c]),s.useEffect(()=>{u(M())},[u]);const R=r=>{var l;const t=(l=r.fileList[r.fileList.length-1])==null?void 0:l.originFileObj;if(t){j(t);const b=new FileReader;b.onload=()=>x(b.result),b.readAsDataURL(t)}},a=r=>{_(r),g.setFieldsValue({end_time:null})},h=async r=>{if(!d)return y.error("Please upload an image");const t=new FormData;t.append("title",r.title),t.append("link_url",r.link_url),t.append("start_time",r.start_time),t.append("end_time",r.end_time),t.append("image",d),t.append("city_id",parseInt(r.city_id)),t.append("position",r.position);try{await u(N(t)),y.success("Banner added successfully"),f(!1),g.resetFields(),j(null),x(null),u(A())}catch{y.error("Failed to add banner")}};return e.jsx(L,{title:"Add Banner",open:c,onCancel:()=>f(!1),footer:null,children:e.jsx("div",{ref:m,style:{maxHeight:"70vh",overflowY:"auto",paddingRight:10},children:e.jsxs(i,{form:g,layout:"vertical",onFinish:h,children:[e.jsx(i.Item,{label:"Title",name:"title",rules:[{required:!0}],children:e.jsx(k,{})}),e.jsx(i.Item,{label:"Link URL",name:"link_url",rules:[{required:!0}],children:e.jsx(k,{})}),e.jsx(i.Item,{label:"Start Time",name:"start_time",rules:[{required:!0}],children:e.jsx(C,{showTime:!0,format:"YYYY-MM-DD hh:mm A",use12Hours:!0,style:{width:"100%"},onChange:a,disabledDate:r=>r&&r<B().startOf("day")})}),e.jsx(i.Item,{label:"End Time",name:"end_time",rules:[{required:!0}],children:e.jsx(C,{showTime:!0,format:"YYYY-MM-DD hh:mm A",use12Hours:!0,style:{width:"100%"},disabled:!p,disabledDate:r=>r&&p&&r<p.startOf("day")})}),e.jsx(i.Item,{name:"position",label:"Banner Type",rules:[{required:!0,message:"Please select banner type"}],children:e.jsxs(w,{children:[e.jsx(U,{value:"Home Page Banner",children:"Home Page Banner"}),e.jsx(U,{value:"Top Banner",children:"Top Banner"})]})}),e.jsx(i.Item,{name:"city_id",label:"Select Locality",rules:[{required:!0,message:"Please select a locality"}],children:e.jsx(w,{placeholder:"Select a locality",loading:T,children:I==null?void 0:I.map(r=>e.jsx(U,{value:r.id,children:r.name},r.id))})}),e.jsxs(i.Item,{label:"Upload Image",name:"image",rules:[{required:!0,message:"Please upload an image"}],children:[e.jsxs(Z,{name:"file",multiple:!1,showUploadList:!1,beforeUpload:()=>!1,onChange:R,accept:".png,.jpg,.jpeg,.webp",style:{borderRadius:8},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(H,{style:{color:"#1677ff"}})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag image to this area to upload"}),e.jsx("p",{className:"ant-upload-hint",children:"Supports .png, .jpg, .jpeg, .webp files (max 1 file)"})]}),o&&e.jsx(Y,{src:o,alt:"Preview",width:120,style:{marginTop:10,borderRadius:8},preview:!1})]}),e.jsx(i.Item,{children:e.jsx(D,{type:"primary",htmlType:"submit",block:!0,className:"custom-orange-button",children:"Submit"})})]})})})}),te="https://api.houseapp.in/public",{Option:v}=w,{Dragger:re}=O,se=s.forwardRef(({data:n},S)=>{const[c,f]=s.useState(!1),[m]=i.useForm(),[g,o]=s.useState(null),[x,d]=s.useState(null),[j,p]=s.useState(null),_=s.useRef(null),u=q(),{cities:I,loading:T}=P(t=>t.location);s.useImperativeHandle(S,()=>({open:()=>{f(!0)}})),s.useEffect(()=>{c&&n&&(m.setFieldsValue({title:n.title,link_url:n.link_url,position:n.position,start_time:B(n.start_time),end_time:B(n.end_time),city_id:n.city_id}),o(`${te}/${n.image_url}`),d(null))},[c,n]);const R=t=>{var b;const l=(b=t.fileList[t.fileList.length-1])==null?void 0:b.originFileObj;if(l){d(l);const F=new FileReader;F.onload=()=>o(F.result),F.readAsDataURL(l)}},a=t=>{p(t),m.setFieldsValue({end_time:null})},h=async t=>{try{const l=new FormData;l.append("title",t.title),l.append("link_url",t.link_url),l.append("start_time",t.start_time.toISOString()),l.append("end_time",t.end_time.toISOString()),l.append("city_id",t.city_id),l.append("position",t.position),x&&l.append("image",x),await new Promise(b=>setTimeout(b,1e3)),y.success("Banner updated successfully"),f(!1),m.resetFields(),d(null),o(null),p(null)}catch{y.error("Failed to update banner")}},r=()=>{f(!1),m.resetFields(),d(null),o(null),p(null)};return s.useEffect(()=>{u(M())},[u]),e.jsx(L,{title:"Update Banner",open:c,onCancel:r,footer:null,destroyOnClose:!0,width:600,children:e.jsx("div",{ref:_,style:{maxHeight:"70vh",overflowY:"auto",paddingRight:10},children:e.jsxs(i,{form:m,layout:"vertical",onFinish:h,children:[e.jsx(i.Item,{label:"Title",name:"title",rules:[{required:!0,message:"Title is required"}],children:e.jsx(k,{})}),e.jsx(i.Item,{label:"Link URL",name:"link_url",rules:[{required:!0,message:"Link URL is required"}],children:e.jsx(k,{})}),e.jsx(i.Item,{label:"Start Time",name:"start_time",rules:[{required:!0,message:"Start time is required"}],children:e.jsx(C,{showTime:!0,format:"YYYY-MM-DD hh:mm A",use12Hours:!0,style:{width:"100%"},onChange:a,disabledDate:t=>t&&t<B().startOf("day")})}),e.jsx(i.Item,{label:"End Time",name:"end_time",rules:[{required:!0,message:"End time is required"}],children:e.jsx(C,{showTime:!0,format:"YYYY-MM-DD hh:mm A",use12Hours:!0,style:{width:"100%"},disabled:!j,disabledDate:t=>t&&j&&t<j})}),e.jsx(i.Item,{name:"position",label:"Banner Type",rules:[{required:!0,message:"Please select banner type"}],children:e.jsxs(w,{children:[e.jsx(v,{value:"Home Page Banner",children:"Home Page Banner"}),e.jsx(v,{value:"Top Banner",children:"Top Banner"})]})}),e.jsx(i.Item,{name:"city_id",label:"Select Locality",rules:[{required:!0,message:"Please select a locality"}],children:e.jsx(w,{placeholder:"Select a locality",loading:T,children:I.map(t=>e.jsx(v,{value:t.id,children:t.name},t.id))})}),e.jsx(i.Item,{label:"Upload Image",name:"image",rules:[{required:!g,message:"Image is required"}],children:g?e.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[e.jsx(Y,{src:g,alt:"Preview",width:120,style:{borderRadius:8},preview:!1}),e.jsx(G,{onClick:()=>{o(null),d(null)},style:{position:"absolute",top:-10,right:-10,fontSize:20,color:"red",cursor:"pointer",background:"white",borderRadius:"50%"},title:"Remove Image"})]}):e.jsxs(re,{name:"file",multiple:!1,showUploadList:!1,beforeUpload:()=>!1,onChange:R,accept:".png,.jpg,.jpeg,.webp",style:{borderRadius:8},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(H,{style:{color:"#1677ff"}})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag image to this area to upload"}),e.jsx("p",{className:"ant-upload-hint",children:"Supports .png, .jpg, .jpeg, .webp files (max 1 file)"})]})}),e.jsx(i.Item,{children:e.jsx(D,{type:"primary",htmlType:"submit",block:!0,className:"custom-orange-button",children:"Update Now"})})]})})})}),ae="https://api.houseapp.in/public",Oe=()=>{const n=q(),{banners:S,loading:c}=P(a=>a.banner),[f,m]=s.useState(null),[g,o]=s.useState(!1),[x,d]=s.useState(""),[j,p]=s.useState(null),_=s.useRef(),u=s.useRef();s.useEffect(()=>{n(A())},[n]);const I=a=>{p(a),d(""),o(!0)},T=()=>{if(!x){y.warning("Please enter your password");return}n(z(x)).then(a=>{var h,r;if(!((h=a.payload)!=null&&h.success)){y.error(((r=a.payload)==null?void 0:r.message)||"Incorrect password");return}n(V(j)).then(()=>{y.success("Banner deleted successfully"),o(!1),d(""),p(null),n(A())})})},R=[{title:"Title",dataIndex:"title",render:(a,h)=>e.jsx("a",{href:h.link_url,target:"_blank",rel:"noreferrer",children:a})},{title:"Image",dataIndex:"image_url",render:(a,h)=>e.jsx("a",{href:h.link_url,target:"_blank",rel:"noreferrer",children:e.jsx(Y,{width:100,src:`${ae}${a}`})})},{title:"City Name",dataIndex:"city_name"},{title:"Start Time",dataIndex:"start_time"},{title:"End Time",dataIndex:"end_time"},{title:"Active",dataIndex:"is_active",render:a=>e.jsx(Q,{color:a?"green":"red",children:a?"Active":"Inactive"})},{title:"Position",dataIndex:"position"},{title:"Actions",render:a=>e.jsxs(W,{children:[e.jsx(E,{title:"Edit",children:e.jsx(D,{icon:e.jsx($,{}),className:"custom-orange-button",onClick:()=>{m(a),u.current.open(a)}})}),e.jsx(E,{title:"Delete",children:e.jsx(D,{danger:!0,icon:e.jsx(X,{}),onClick:()=>I(a.banner_id)})})]})}];return e.jsxs("div",{style:{padding:24},children:[e.jsx("div",{style:{textAlign:"right",marginBottom:16},children:e.jsx(D,{className:"custom-orange-button",type:"primary",icon:e.jsx(K,{}),onClick:()=>_.current.open(),children:"Add Banner"})}),e.jsx(J,{columns:R,dataSource:S,rowKey:"id",pagination:{pageSize:10},bordered:!0,loading:c}),e.jsx(ee,{ref:_}),e.jsx(se,{ref:u,data:f}),e.jsxs(L,{title:"Confirm Password",open:g,onOk:T,confirmLoading:c,onCancel:()=>o(!1),okText:"Delete",cancelText:"Cancel",children:[e.jsx("p",{children:"Please enter your password to confirm deletion:"}),e.jsx(k.Password,{value:x,onChange:a=>d(a.target.value),placeholder:"Enter password"})]})]})};export{Oe as default};
